trigger:
  - develop

variables:
  - name: registryName
    value: 'acrsharediepdev'
  - name: imageName
    value: '{issuer_keycloak}'                                            #Name Convention que se establezca
  - name: azureSubscription
    value: 'service-endpoint-bs-tf-deploy-apps-iep-dev'
  - name: appServiceName
    value: '{app-cross-keycloak-ms-iep-dev.azurewebsites.net}'                                       #El que toque respecto al AppService definido

pool:
  vmImage: ubuntu-latest

steps:
  - task: AzureCLI@2
    displayName: AZ ACR Login
    inputs:
      azureSubscription: $(azureSubscription)
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: 'az acr login --name $(registryName)'
  - task: AzureCLI@2
    displayName: AZ ACR Build
    inputs:
      azureSubscription: $(azureSubscription)
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: 'az acr build -t $(imageName):$(Build.BuildId) -t $(imageName):latest -r $(registryName) -f Dockerfile .'
      useGlobalConfig: true
      workingDirectory: '$(Build.SourcesDirectory)'
  - task: AzureWebAppContainer@1
    displayName: Deploy to App Service
    inputs:
      azureSubscription: '$(azureSubscription)'
      appName: '$(appServiceName)'
      containers: '$(registryName).azurecr.io/$(imageName):latest'